# 代码回放调试指南

## 问题排查步骤

### 1. 检查数据导入
1. 打开浏览器开发者工具 (F12)
2. 切换到 Console 标签
3. 在代码回放页面导入数据时，查看控制台输出

**预期输出:**
```
Parsed data: [...]
Detected ACWing format  // 或 Detected database format
Converted records: [...]
```

### 2. 检查播放启动
点击播放按钮时，查看控制台输出：

**预期输出:**
```
Starting replay with X records
Current step: 0
Scheduling next step. isPlaying: true currentStep: 0 totalRecords: X
Next operation: {...} delay: 100ms
```

### 3. 检查操作执行
每个操作执行时的输出：

**预期输出:**
```
Executing step 1: {...}
Executing operation type: 0 content: "#"
Inserting at row: 0 col: 0 content: #
executeInsert called with: {row: 0, col: 0, content: "#", currentLines: 1}
Line parts: {line: "", beforeCursor: "", afterCursor: ""}
Handling character insertion
Lines after insert: ["#"]
Lines after operation: ["#"]
Code after operation: #
```

## 常见问题及解决方案

### 问题1: 数据导入失败
**症状**: 导入时弹出"导入失败"提示
**解决**: 
1. 检查JSON格式是否正确
2. 确保数据不为空
3. 检查数据格式是否符合要求

### 问题2: 播放无效果
**症状**: 点击播放按钮后编辑器没有变化
**可能原因**:
1. 数据格式不正确
2. 操作类型不被识别
3. 时间戳计算错误

**调试步骤**:
1. 检查控制台是否有 "Starting replay" 输出
2. 检查是否有 "Executing step" 输出
3. 检查操作内容是否正确

### 问题3: 字符插入位置错误
**症状**: 字符出现在错误位置
**可能原因**:
1. 行列坐标计算错误
2. 编辑器行数不足

**调试步骤**:
1. 检查 executeInsert 的输入参数
2. 检查行列坐标是否正确

## 手动测试步骤

### 1. 使用示例数据测试
1. 访问 `/code-replay` 页面
2. 点击"加载示例数据"
3. 点击"导入记录"
4. 点击"播放"
5. 观察是否出现 `#include <iostream>` 等字符

### 2. 使用自定义数据测试
创建简单的测试数据：
```json
[
  {
    "type": 0,
    "old_row": null,
    "old_col": null,
    "new_row": 0,
    "new_col": 0,
    "content": "H",
    "timestamp": 1000
  },
  {
    "type": 0,
    "old_row": null,
    "old_col": null,
    "new_row": 0,
    "new_col": 1,
    "content": "i",
    "timestamp": 2000
  }
]
```

### 3. 单步测试
1. 导入数据后不要点击播放
2. 点击"单步"按钮逐步执行
3. 观察每步的变化

## 调试信息说明

### 控制台输出含义
- `Starting replay`: 播放开始
- `Scheduling next step`: 安排下一步操作
- `Executing step X`: 执行第X步操作
- `executeInsert called`: 插入操作被调用
- `Lines after operation`: 操作后的代码行数组

### 关键检查点
1. **records.value.length**: 确保有记录数据
2. **currentStep.value**: 当前执行步骤
3. **isPlaying.value**: 播放状态
4. **操作类型**: 确保类型值正确 (0=插入, 1=删除等)

## 如果问题仍然存在

请提供以下信息：
1. 控制台的完整输出
2. 导入的数据格式
3. 具体的问题现象
4. 浏览器版本信息

这样我可以更准确地定位和修复问题。